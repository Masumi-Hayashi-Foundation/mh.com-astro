---
// Import necessary components and utilities
import CloudinaryImage from "../../../components/CloudinaryImage.astro";
import { getCollection } from "astro:content";

// Define TypeScript interface for stronger type checks (if your project supports TypeScript)
interface ArtworkEntry {
  data: {
    slug: string;
    title: string;
    name: string;
    cloudinaryId: string;
    altTag: string;
    media: string;
    year: string;
    size: string;
    inventory: string;
    city: string;
    state: string;
    country: string;
  };
}

export async function getStaticPaths() {
  const blogEntries = await getCollection("art-pages");
  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

// Fetch all entries from the "art-pages" collection
const allArtPagesEntries = await getCollection("art-pages");
console.log(allArtPagesEntries);

// Extract the `slug` parameter from the URL
const params = Astro.params;
console.log(params);

// Find the specific artwork entry based on the slug
const artwork = allArtPagesEntries.find((entry: any) => {
  return entry.slug === params.slug;
}) as ArtworkEntry | undefined;

console.log(artwork);

// Throw an error if no artwork is found
if (!artwork) {
  throw new Error("Artwork not found");
}
---

<html>
  <head>
    <title>{artwork.data.title}</title>
    <meta
      name="description"
      content={`Artwork: ${artwork.data.name}; Artist: Dr. Masumi Hayashi`}
    />
  </head>
  <body>
    <article>
      <h1>{artwork.data.name}</h1>
      <section>
        <CloudinaryImage
          cloudinaryId={artwork.data.cloudinaryId}
          alt={artwork.data.altTag}
          title={artwork.data.title}
          media={artwork.data.media}
          year={artwork.data.year}
          size={artwork.data.size}
          inventory={artwork.data.inventory}
        />
        <figcaption>
          {artwork.data.title} - {artwork.data.media}, {artwork.data.year}.
          Located in {artwork.data.city}, {artwork.data.state}, {
            artwork.data.country
          }. Size: {artwork.data.size}.
        </figcaption>
      </section>
    </article>
  </body>
</html>
